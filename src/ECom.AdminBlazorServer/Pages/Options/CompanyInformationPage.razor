@using ECom.Shared.Abstract.Services.Admin
@using ECom.Shared.Entities
@using EasMe.Extensions
@using ECom.Shared.Constants
@inherits SharedBasePage
@inject IAdminCompanyInformationService CompanyInformationService
@page "/options/company"
<RadzenRow class="mb-5">
  <RadzenColumn>
    <RadzenCard Style="max-width:750px">
      <RadzenTemplateForm TItem="CompanyInformation" @bind-Data="_edited" Submit="UpdateCompanyInfo" InvalidSubmit="ShowInvalidFormNotification">
        <DataAnnotationsValidator></DataAnnotationsValidator>
        <RadzenTabs @bind-SelectedIndex=@_selectedIndex RenderMode="TabRenderMode.Client">
          <Tabs>
            <RadzenTabsItem Text="@Loc["general"]">
              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["company_name"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextBox class="w-100" @bind-Value="_edited.CompanyName" Name="CompanyName" MaxLength="@ValidationSettings.MaxNameLength"></RadzenTextBox>
                  <ValidationMessage For="() => _edited.CompanyName"></ValidationMessage>
                </RadzenColumn>
              </RadzenRow>

              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["phone_number"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenMask class="w-100" Mask="(***) ***-****" Name="PhoneNumber" CharacterPattern="[0-9]" MaxLength="@ValidationSettings.MaxPhoneLength" Placeholder="(000) 000-0000" @bind-Value="_edited.PhoneNumber" />
                  <ValidationMessage For="() => _edited.PhoneNumber"></ValidationMessage>
                </RadzenColumn>
              </RadzenRow>

              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["contact_email"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextBox class="w-100" Name="EmailAddress" MaxLength="@ValidationSettings.MaxEmailLength" Placeholder="example.mail.com" @bind-Value="_edited.ContactEmail" />
                  <validationMessage For="() => _edited.ContactEmail"></validationMessage>
                </RadzenColumn>
              </RadzenRow>

              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["description"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextArea class="w-100" Style="min-height: 100px" @bind-Value="_edited.Description" Name="Description" MaxLength="@ValidationSettings.MaxDescriptionLength"></RadzenTextArea>
                  <Valmessage For="() => _edited.Description"></Valmessage>
                </RadzenColumn>
              </RadzenRow>

              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["company_address"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextArea class="w-100" Name="CompanyAddress" Style="min-height: 100px" @bind-Value="_edited.CompanyAddress" MaxLength="@ValidationSettings.MaxDescriptionLength"></RadzenTextArea>
                  <ValidationMessage For="() => _edited.CompanyAddress"></ValidationMessage>
                </RadzenColumn>
              </RadzenRow>

            </RadzenTabsItem>
            <RadzenTabsItem Text="@Loc["social_media"]">
              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["facebook_link"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextBox class="w-100" @bind-Value="_edited.FacebookLink" Name="FacebookLink" MaxLength="@ValidationSettings.MaxDomainLength"></RadzenTextBox>
                  <ValidationMessage For="() => _edited.FacebookLink"></ValidationMessage>
                </RadzenColumn>
              </RadzenRow>

              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["instagram_link"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextBox class="w-100" @bind-Value="_edited.InstagramLink" Name="InstagramLink" MaxLength="@ValidationSettings.MaxDomainLength"></RadzenTextBox>
                  <ValidationMessage For="() => _edited.InstagramLink"></ValidationMessage>

                </RadzenColumn>
              </RadzenRow>

              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["youtube_link"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextBox class="w-100" @bind-Value="_edited.YoutubeLink" Name="YoutubeLink" MaxLength="@ValidationSettings.MaxDomainLength"></RadzenTextBox>
                  <ValidationMessage For="() => _edited.YoutubeLink"></ValidationMessage>

                </RadzenColumn>
              </RadzenRow>

              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["whatsapp"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenMask class="w-100" Mask="(***) ***-****" Name="WhatsApp" CharacterPattern="[0-9]" MaxLength="@ValidationSettings.MaxPhoneLength" Placeholder="(000) 000-0000" @bind-Value="_edited.WhatsApp" />
                  <ValidationMessage For="() => _edited.WhatsApp"></ValidationMessage>

                </RadzenColumn>
              </RadzenRow>



            </RadzenTabsItem>
            <RadzenTabsItem Text="@Loc["urls"]">
              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["domain_url"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextBox @bind-Value="_edited.DomainUrl" Name="DomainUrl" MaxLength="@ValidationSettings.MaxDomainLength"></RadzenTextBox>
                  <ValidationMessage For="() => _edited.DomainUrl"></ValidationMessage>

                </RadzenColumn>
              </RadzenRow>


              <RadzenRow class="my-3">
                <RadzenColumn SizeSM="12" SizeMD="4">
                  <RadzenLabel class="text-center" Text="@Loc["web_api_url"]" />
                </RadzenColumn>
                <RadzenColumn SizeSM="12" SizeMD="8">
                  <RadzenTextBox @bind-Value="_edited.WebApiUrl" Name="WebApiUrl" MaxLength="@ValidationSettings.MaxDomainLength"></RadzenTextBox>
                  <ValidationMessage For="() => _edited.WebApiUrl"></ValidationMessage>

                </RadzenColumn>
              </RadzenRow>

            </RadzenTabsItem>
            <RadzenTabsItem Text="@Loc["images"]">
              @*
              TODO: add image view on button click for both images
              TODO: add image upload on button click for both images

              *@
            </RadzenTabsItem>
          </Tabs>
        </RadzenTabs>
        <RadzenStack class="mt-4 mx-3 mb-3" Orientation="Orientation.Horizontal">
          <RadzenButton ButtonType="ButtonType.Submit" Icon="check" ButtonStyle="ButtonStyle.Success" Text="@Loc["apply_changes"]"></RadzenButton>
          <RadzenButton ButtonType="ButtonType.Button" Icon="settings_backup_restore" Click="ResetForm" ButtonStyle="ButtonStyle.Danger" Text="@Loc["reset"]"></RadzenButton>
          @* <RadzenButton Click="ResetSortableList" Icon="settings_backup_restore" ButtonStyle="ButtonStyle.Danger" Text="@LocalizedResource["reset"]"></RadzenButton> *@

        </RadzenStack>
      </RadzenTemplateForm>
    </RadzenCard>
  </RadzenColumn>
</RadzenRow>
@*TODO: Add save and reset button functionality*@



@code {
  int _selectedIndex = 0;
  private CompanyInformation _original = new CompanyInformation();
  private CompanyInformation _edited = new CompanyInformation();
  protected override void OnInitialized() {
    _original = CompanyInformationService.GetCompanyInformation();
    _edited = _original.CloneCast();
  }

  private async Task UpdateCompanyInfo(CompanyInformation obj) {
    var dialogResult = await ShowSimpleDialogLocalized(SimpleActionType.update, "company_information");
    if (!dialogResult) return;
    var result = CompanyInformationService.UpdateCompanyInformation(_edited);
    ShowResultNotification(result);
    if (!result.Status) return;
    _original = CompanyInformationService.GetCompanyInformation();
    _edited = _original.CloneCast();

  }

  private void ResetForm() {
    _edited = CompanyInformationService.GetCompanyInformation();
    _edited = _original.CloneCast();

    StateHasChanged();
    ShowResultNotification(DomainResult.Success("reset_successful"));

  }


}
