@inject DialogService DialogService
@inject NotificationService NotificationService
@inherits ComponentBase

@code {
  //const int defaultDuration = 4000;
  protected void ShowResultNotification(CustomResult result, int duration = 3000) {
    var error = result.GetErrorAndName();
    var text = Loc[error.error].Format("name",error.name);

    var message = new NotificationMessage {
      Severity = SeverityFromResultLevel(result.Level),
          Summary = Loc[result.LevelText],
      Detail = text,
      Duration = duration
    };
    NotificationService.Notify(message);
  }

  protected void ShowNotification(NotificationSeverity severity, string text, int duration = 3000) {
    var message = new NotificationMessage {
      Severity = severity,
          Summary = Loc[severity.ToString().ToLower()],
      Detail = text,
      Duration = duration
    };
    NotificationService.Notify(message);
  }

  protected async Task ShowResultDialog(CustomResult result) {
    var error = result.GetErrorAndName();
    var text = Loc[error.error].Format("name", error.name);
    _ = await DialogService.OpenAsync(Loc[result.LevelText], ds =>
      @<RadzenStack >
      <RadzenText TextStyle="TextStyle.Body1" TagName="TagName.P">@text</RadzenText>
        <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
          <RadzenStack Orientation="Orientation.Horizontal">
            <RadzenButton Text="Ok" Click="() => { ds.Close(true); }" Style="width: 80px;"/>
          </RadzenStack>
        </RadzenStack>
      </RadzenStack>
      , new DialogOptions {
        Height = "auto",
        Width = "250px"
      });
  }


  protected async Task<bool> ShowSimpleDialog(SimpleDialogType type, string name, string title = "Confirm") {
    var text = Loc["simple_dialog_confirmation"].Format("action", Loc[type.ToString().ToLower()]).Format("name", Loc["name"]);
    var showOkButton = type.ShowOkButton();
    var showCancelButton = type.ShowCancelButton();

    var result = await DialogService.OpenAsync(title, ds =>
      @<RadzenStack Gap="1.5rem">
      <RadzenText TextStyle="TextStyle.Body1" TagName="TagName.P">@text</RadzenText>
        <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
          <RadzenStack Orientation="Orientation.Horizontal">
            <RadzenButton Visible="showOkButton" Text="Ok" Click="() => { ds.Close(true); }" Style="width: 120px;"/>
            <RadzenButton Visible="showCancelButton" Text="Cancel" Click="() => ds.Close(false)" ButtonStyle="ButtonStyle.Light"/>
          </RadzenStack>
        </RadzenStack>
      </RadzenStack>
      , new DialogOptions {
        Height = "auto",
        Width = "320px"
      });
    return result == true;
  }

  private NotificationSeverity SeverityFromResultLevel(CustomResultLevel level) {
    return level switch {
      CustomResultLevel.Info => NotificationSeverity.Success,
      CustomResultLevel.Warning => NotificationSeverity.Warning,
      CustomResultLevel.Error => NotificationSeverity.Error,
      CustomResultLevel.Critical => NotificationSeverity.Error,
      _ => NotificationSeverity.Error
      };
  }

}