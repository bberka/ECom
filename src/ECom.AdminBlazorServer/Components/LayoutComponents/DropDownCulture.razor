@using ECom.Shared.DTOs
@using Microsoft.AspNetCore.Localization
@inject SupportedCultures SupportedCultures

<RadzenDropDown class="mx-2" TValue="string" Data="SupportedCultures.Dictionary" ValueProperty="Key" @bind-Value="_selectedCulture" Change="OnChange" TextProperty="Value" Name="CultureSelect">

</RadzenDropDown>

@code {
  private string? _selectedCulture;

  protected override void OnInitialized() {
    if (string.IsNullOrEmpty(_selectedCulture)) _selectedCulture = Thread.CurrentThread.CurrentCulture.Name;
    //selectedCulture = System.Threading.Thread.CurrentThread.CurrentCulture.Name; @bind-Value="_selectedCulture"
  }

  private void OnChange() {
    //var context = HttpContextAccessor.HttpContext;

    var redirectPath = new Uri(Nav.Uri)
      .GetComponents(UriComponents.PathAndQuery, UriFormat.Unescaped);
    var culture = _selectedCulture;
    if (string.IsNullOrWhiteSpace(culture)) {
      culture = "en-US";
    }
    var isSupported = SupportedCultures.Dictionary.TryGetValue(culture, out _);
    if (!isSupported) {
      culture = "en-US";
    }
    JsCookieUtil.SetValue(CookieRequestCultureProvider.DefaultCookieName, CookieRequestCultureProvider.MakeCookieValue(new RequestCulture(culture)), TimeSpan.FromDays(365));
    Nav.NavigateTo(redirectPath, true);
  }


}